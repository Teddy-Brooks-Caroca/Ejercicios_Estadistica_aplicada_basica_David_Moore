
Cuando queremos analizar la relación entre **dos variables categóricas**, una forma fundamental de hacerlo es mediante una **tabla de contingencia** (también llamada tabla cruzada). Esta tabla resume los **recuentos** (frecuencias absolutas) de observaciones que combinan cada categoría de una variable con cada categoría de la otra.

Por ejemplo, supongamos que registramos el **género** (masculino/femenino) y la **preferencia de producto** (A/B/C) de un grupo de consumidores. Una tabla de contingencia mostrará cuántos hombres prefieren A, cuántas mujeres prefieren B, y así sucesivamente.

---

### Cómo construir una tabla de contingencia en R

En R, la forma más directa es con la función `table()`:

```R
# Ejemplo de datos
genero <- c("Hombre", "Mujer", "Mujer", "Hombre", "Mujer", "Hombre")
producto <- c("A", "A", "B", "C", "A", "B")

# Tabla de contingencia
tabla <- table(genero, producto)
tabla
```

**Salida:**

```
        producto
genero   A B C
Hombre   1 1 1
Mujer    2 1 0
```

Esta tabla resume los recuentos de observaciones según ambas variables.

---

### Distribuciones marginales y condicionales

- Las **distribuciones marginales** se obtienen al sumar por filas o por columnas:
    

```R
margin.table(tabla, 1) # Suma por filas → distribución marginal de 'género'
margin.table(tabla, 2) # Suma por columnas → distribución marginal de 'producto'
```

- Las **distribuciones condicionales** muestran proporciones dentro de una categoría de la variable explicativa:
    

```R
prop.table(tabla, 2)  # proporciones por columna
prop.table(tabla, 1)  # proporciones por fila
```

Esto permite analizar si, por ejemplo, la preferencia por un producto varía según el género.

---

### Relación con la función `mapply()`

Aunque `table()` es la forma más directa de construir tablas de contingencia, R permite una mayor flexibilidad con **`mapply()`**, especialmente cuando queremos **combinar o aplicar funciones sobre varias variables categóricas simultáneamente**.

La función `mapply()` aplica una función elemento a elemento sobre varios vectores de igual longitud.  
Podemos usarla para **contar combinaciones** o **construir tablas personalizadas**.

**Ejemplo:**

```R
# Creamos una función que concatena las categorías
combinaciones <- mapply(function(g, p) paste(g, p, sep = "_"), genero, producto)

# Contamos las combinaciones resultantes
tabla_mapply <- table(combinaciones)
tabla_mapply
```

**Salida:**

```
combinaciones
Hombre_A Hombre_B Hombre_C Mujer_A Mujer_B 
      1       1       1       2       1 
```

Aquí `mapply()` nos permitió **unir las categorías** de dos variables y luego contarlas.  
Esto puede ser útil cuando queremos representar las combinaciones en un formato distinto, o generar **llaves únicas** para usar en modelos, etiquetas o gráficos.

---

### Visualización: diagramas de barras agrupadas

Una forma visual de mostrar la relación entre dos variables categóricas es mediante **diagramas de barras**:

```R
# Usando ggplot2
library(ggplot2)

datos <- data.frame(genero, producto)

ggplot(datos, aes(x = producto, fill = genero)) +
  geom_bar(position = "dodge") +
  labs(title = "Preferencia de producto según género",
       x = "Producto", y = "Frecuencia") +
  theme_minimal()
```

Este gráfico permite ver si existe una asociación visible entre las categorías:  
por ejemplo, si los hombres prefieren un producto más que las mujeres.

---

### La paradoja de Simpson

Un fenómeno importante en el análisis de tablas de contingencia es la **paradoja de Simpson**:  
una relación entre dos variables puede **invertirse o desaparecer** al incluir o excluir una **tercera variable** (una variable latente).

Esto nos recuerda que las asociaciones observadas pueden ser **engañosas** si no consideramos variables ocultas que influyen en ambas.

---

### En síntesis

- Una **tabla de contingencia** resume la relación entre dos variables categóricas.
    
- Las **distribuciones marginales** y **condicionales** ayudan a entender la estructura de los datos.
    
- **`mapply()`** puede complementar `table()` cuando necesitamos construir combinaciones personalizadas o aplicar funciones sobre pares de categorías.
    
- Las **visualizaciones** refuerzan el análisis exploratorio y ayudan a detectar asociaciones o patrones ocultos.
    
- Y, como siempre, debemos interpretar las asociaciones con cautela, considerando posibles variables latentes.
    

---
