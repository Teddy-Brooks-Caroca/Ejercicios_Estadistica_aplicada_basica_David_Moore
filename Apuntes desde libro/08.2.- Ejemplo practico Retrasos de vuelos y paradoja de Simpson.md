
### 1. Cargar los datos

```r
# Datos de vuelos: n√∫mero de llegadas "a hora" y "con retraso"
datos <- data.frame(
  Aeropuerto = c("Los Angeles", "Phoenix", "San Diego", "San Francisco", "Seattle"),
  Alaska_Ahora = c(497, 221, 212, 503, 1841),
  Alaska_Ret = c(62, 12, 20, 102, 305),
  AmericaWest_Ahora = c(694, 4840, 383, 320, 201),
  AmericaWest_Ret = c(117, 415, 65, 129, 61)
)
```

---

### 2. Tablas b√°sicas de contingencia

Podemos usar `table()` cuando tenemos variables categ√≥ricas puras (por ejemplo, si los datos estuvieran en formato largo).  
Aqu√≠, como est√°n en formato ancho, construiremos manualmente una mini-tabla de contingencia:

```r
# Ejemplo de tabla de contingencia para un aeropuerto (Seattle)
tabla_seattle <- matrix(
  c(1841, 305, 201, 61),
  nrow = 2,
  byrow = TRUE,
  dimnames = list(
    "Compa√±√≠a" = c("Alaska", "AmericaWest"),
    "Estado" = c("A hora", "Retraso")
  )
)
tabla_seattle
```

Esto permite calcular f√°cilmente distribuciones condicionales:

```r
prop.table(tabla_seattle, 1)   # porcentajes por compa√±√≠a
```

---

### 3. Calcular porcentajes de retraso por aeropuerto

Primero usaremos **`sapply()`**, que aplica una funci√≥n sobre un vector o lista y devuelve un vector con los resultados.

```r
# Funci√≥n para calcular el porcentaje de retrasos
porc_retraso <- function(a_hora, retraso) {
  retraso / (a_hora + retraso)
}

# Aplicamos sapply para Alaska y America West
pct_A <- sapply(1:nrow(datos), function(i) porc_retraso(datos$Alaska_Ahora[i], datos$Alaska_Ret[i]))
pct_W <- sapply(1:nrow(datos), function(i) porc_retraso(datos$AmericaWest_Ahora[i], datos$AmericaWest_Ret[i]))

# Resultados por aeropuerto
data.frame(
  Aeropuerto = datos$Aeropuerto,
  Alaska = round(pct_A * 100, 2),
  AmericaWest = round(pct_W * 100, 2)
)
```

---

### 4. C√°lculo global con `mapply()`

Ahora, para calcular el **porcentaje global ponderado**, usamos `mapply()`, que aplica una funci√≥n a varios vectores _en paralelo_:

```r
# mapply permite aplicar una funci√≥n a varios vectores a la vez
pct_A_por_aeropuerto <- mapply(porc_retraso, datos$Alaska_Ret, datos$Alaska_Ahora)
pct_W_por_aeropuerto <- mapply(porc_retraso, datos$AmericaWest_Ret, datos$AmericaWest_Ahora)

# Pesos: total de vuelos por aeropuerto
pesos_A <- mapply(sum, datos$Alaska_Ahora, datos$Alaska_Ret)
pesos_W <- mapply(sum, datos$AmericaWest_Ahora, datos$AmericaWest_Ret)

# Promedio ponderado global
pct_global_A <- sum(pct_A_por_aeropuerto * pesos_A) / sum(pesos_A)
pct_global_W <- sum(pct_W_por_aeropuerto * pesos_W) / sum(pesos_W)

round(c(Alaska = pct_global_A, AmericaWest = pct_global_W) * 100, 2)
```

üëâ **Interpretaci√≥n:**

- Por aeropuerto, **America West parece tener m√°s retrasos**.
    
- Pero al combinar todos los datos, **Alaska Airlines muestra un mayor porcentaje total de retrasos**.  
    Esto es un ejemplo cl√°sico de la **paradoja de Simpson**, donde una variable latente (en este caso, el aeropuerto) cambia la interpretaci√≥n global.
    

---

### 5. Visualizaci√≥n r√°pida

Podemos visualizar los porcentajes con un diagrama de barras:

```r
# Creamos un peque√±o data frame con los resultados
porcentajes <- data.frame(
  Aeropuerto = rep(datos$Aeropuerto, 2),
  Compa√±√≠a = rep(c("Alaska", "AmericaWest"), each = nrow(datos)),
  Retraso = c(pct_A, pct_W)
)

# Diagrama de barras agrupado
barplot(
  tapply(porcentajes$Retraso, list(porcentajes$Aeropuerto, porcentajes$Compa√±√≠a), mean),
  beside = TRUE,
  col = c("steelblue", "tomato"),
  main = "Porcentaje de retrasos por compa√±√≠a y aeropuerto",
  ylab = "Proporci√≥n de retrasos",
  legend.text = TRUE
)
```

---

### üìò Conclusi√≥n

- `table()` sirve para **resumir variables categ√≥ricas** en frecuencias.
    
- `sapply()` y `mapply()` son funciones aplicadas √∫tiles para **automatizar c√°lculos sobre m√∫ltiples pares de datos**.
    
- Este ejercicio ilustra c√≥mo una **variable latente** (aeropuerto) puede invertir las conclusiones globales ‚Äî un caso cl√°sico de la **paradoja de Simpson**.
    

---
